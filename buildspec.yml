version: 0.2

phases:
  install:
    runtime-versions:
      nodejs: 14

  pre_build:
    commands:
      - echo "Setting up environment variables"
      - if [ -n "$CODEBUILD_WEBHOOK_HEAD_REF" ]; then
        BRANCH_NAME=${CODEBUILD_WEBHOOK_HEAD_REF#refs/heads/};
        else
        BRANCH_NAME=${CODEBUILD_SOURCE_VERSION#refs/heads/};
        fi
      - echo "Branch name: $BRANCH_NAME"
      - if [ "$BRANCH_NAME" == "main" ]; then
        export ENVIRONMENT="production";
        elif [ "$BRANCH_NAME" == "dev" ]; then
        export ENVIRONMENT="development";
        else
        export ENVIRONMENT="unknown";
        fi
      - echo "Environment: $ENVIRONMENT"

  build:
    commands:
      - ./print_env.sh

artifacts:
  files:
    - print_env.sh
